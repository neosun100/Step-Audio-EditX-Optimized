# Step-Audio-EditX

<p align="center">
  <img src="assets/logo.png" height=100>
</p>

<div align="center">
  <a href="https://stepaudiollm.github.io/step-audio-editx/"><img src="https://img.shields.io/static/v1?label=Demo%20Page&message=Web&color=green"></a> &ensp;
  <a href="https://arxiv.org/abs/2511.03601"><img src="https://img.shields.io/static/v1?label=Tech%20Report&message=Arxiv&color=red"></a> &ensp;
  <a href="https://huggingface.co/stepfun-ai/Step-Audio-EditX"><img src="https://img.shields.io/static/v1?label=Step-Audio-EditX&message=HuggingFace&color=yellow"></a> &ensp;
  <a href="https://modelscope.cn/models/stepfun-ai/Step-Audio-EditX"><img src="https://img.shields.io/static/v1?label=Step-Audio-EditX&message=ModelScope&color=blue"></a> &ensp;
  <a href="https://huggingface.co/spaces/stepfun-ai/Step-Audio-EditX"><img src="https://img.shields.io/static/v1?label=Space%20Playground&message=HuggingFace&color=yellow"></a> &ensp;
</div>

## ğŸ”¥ æœ€æ–°æ›´æ–°

### 2025-12-04: ç»Ÿä¸€éƒ¨ç½²æ¶æ„ ğŸš€

#### ğŸ¯ æ ¸å¿ƒä¼˜åŒ–
- **ç»Ÿä¸€å®¹å™¨éƒ¨ç½²**ï¼šUI + API å…±äº«åŒä¸€ä¸ªæ¨¡å‹å®ä¾‹
- **èµ„æºèŠ‚çœ 50%**ï¼šæ˜¾å­˜å ç”¨ä» ~80GB é™è‡³ ~41GB
- **ç»Ÿä¸€ç«¯å£è®¿é—®**ï¼šä¸€ä¸ªç«¯å£æä¾›æ‰€æœ‰åŠŸèƒ½ï¼ˆUIã€APIã€å¥åº·æ£€æŸ¥ï¼‰
- **å®Œæ•´åŠŸèƒ½ä¿ç•™**ï¼šæ‰€æœ‰ä¼˜åŒ–åŠŸèƒ½ï¼ˆFunASRç¼“å­˜ã€Whisperè½¬å†™ã€å®æ—¶æ—¥å¿—ï¼‰å…¨éƒ¨ä¿ç•™

#### ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | åˆ†ç¦»éƒ¨ç½² | ç»Ÿä¸€éƒ¨ç½² | æ”¹è¿› |
|------|---------|---------|------|
| å®¹å™¨æ•° | 2ä¸ª | 1ä¸ª | **-50%** |
| æ¨¡å‹å®ä¾‹ | 2ä¸ª | 1ä¸ª | **-50%** |
| æ˜¾å­˜å ç”¨ | ~80GB | ~41GB | **-49%** |
| ç«¯å£å ç”¨ | 2ä¸ª | 1ä¸ª | **-50%** |

#### ğŸŒ è®¿é—®æ–¹å¼
- **UI ç•Œé¢**: http://localhost:7860
- **API æ–‡æ¡£**: http://localhost:7860/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:7860/healthz

---

### 2025-11-22: é‡å¤§æ€§èƒ½ä¼˜åŒ–ä¸ API æ‹†åˆ†

#### âš¡ æ€§èƒ½ä¼˜åŒ–æˆæœ
- **FunASR æŒä¹…åŒ–ç¼“å­˜**ï¼šä» 24s ä¼˜åŒ–åˆ° **8s**ï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰ï¼Œ**æé€Ÿ 3x** ğŸš€
- **TF32 åŠ é€Ÿ**ï¼šå¯ç”¨ Ampere GPU çš„ TensorFloat-32 åŠ é€Ÿï¼Œæå‡ 10-20%
- **ONNX Runtime ä¼˜åŒ–**ï¼šä¼˜åŒ–çº¿ç¨‹é…ç½®å’Œå¹¶è¡Œæ‰§è¡Œï¼Œæå‡ 10-30%
- **å®æ—¶æ€§èƒ½ç›‘æ§**ï¼šæ–°å¢ç¼“å­˜ç»Ÿè®¡å’Œå®æ—¶æ—¥å¿—æ˜¾ç¤ºåŠŸèƒ½

#### ğŸ”Œ API æœåŠ¡æ‹†åˆ†
- **ç‹¬ç«‹ API å®¹å™¨**ï¼šæä¾› OpenAI å…¼å®¹çš„ REST API æœåŠ¡
- **åŒå®¹å™¨æ¶æ„**ï¼šUI å’Œ API å¯ç‹¬ç«‹éƒ¨ç½²ï¼Œäº’ä¸å¹²æ‰°
- **å®Œæ•´åŠŸèƒ½æ”¯æŒ**ï¼šAPI æ”¯æŒæ‰€æœ‰ UI åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç¼“å­˜ä¼˜åŒ–

#### ğŸ¯ åŠŸèƒ½å¢å¼º
- **Model Variant é€‰æ‹©**ï¼šæ”¯æŒ `base`ã€`awq`ã€`bnb` ä¸‰ç§æ¨¡å‹å˜ä½“
- **Intensity å‚æ•°æ§åˆ¶**ï¼šç²¾ç»†æ§åˆ¶ç¼–è¾‘å¼ºåº¦ï¼ˆ0.1-3.0ï¼‰
- **Whisper ASR è‡ªåŠ¨è½¬å†™**ï¼šæ”¯æŒè‡ªåŠ¨éŸ³é¢‘è½¬å†™åŠŸèƒ½
- **å®æ—¶æ—¥å¿—ç³»ç»Ÿ**ï¼šå®Œæ•´çš„æ‰§è¡Œæ—¥å¿—å’Œç¼“å­˜ç»Ÿè®¡å±•ç¤º

### å†å²æ›´æ–°

* **Nov 19, 2025**: âš™ï¸ å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œæ”¯æŒ**å¤šéŸ³å­—å‘éŸ³æ§åˆ¶**ï¼Œæå‡æƒ…æ„Ÿã€é£æ ¼å’Œå‰¯è¯­è¨€ç¼–è¾‘æ€§èƒ½
* **Nov 12, 2025**: ğŸ“¦ å‘å¸ƒ**ä¼˜åŒ–æ¨ç†ä»£ç **å’Œæ¨¡å‹æƒé‡
* **Nov 07, 2025**: âœ¨ [Demo é¡µé¢](https://stepaudiollm.github.io/step-audio-editx/) å’Œ [HF Space æ¼”ç¤º](https://huggingface.co/spaces/stepfun-ai/Step-Audio-EditX)
* **Nov 06, 2025**: ğŸ‘‹ å‘å¸ƒæŠ€æœ¯æŠ¥å‘Š [Step-Audio-EditX](https://arxiv.org/abs/2511.03601)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

Step-Audio-EditX æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ **3B å‚æ•°**åŸºäº LLM çš„**å¼ºåŒ–å­¦ä¹ **éŸ³é¢‘æ¨¡å‹ï¼Œä¸“é—¨ç”¨äºè¡¨è¾¾æ€§å’Œè¿­ä»£å¼éŸ³é¢‘ç¼–è¾‘ã€‚å®ƒåœ¨ç¼–è¾‘æƒ…æ„Ÿã€è¯´è¯é£æ ¼å’Œå‰¯è¯­è¨€æ–¹é¢è¡¨ç°å‡ºè‰²ï¼ŒåŒæ—¶å…·å¤‡å¼ºå¤§çš„é›¶æ ·æœ¬æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰èƒ½åŠ›ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **é›¶æ ·æœ¬è¯­éŸ³å…‹éš†**
  - æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€å››å·è¯å’Œç²¤è¯­çš„ä¼˜ç§€é›¶æ ·æœ¬ TTS å…‹éš†
  - ä½¿ç”¨æ–¹è¨€æ—¶ï¼Œåªéœ€åœ¨æ–‡æœ¬å‰æ·»åŠ  `[Sichuanese]` æˆ– `[Cantonese]` æ ‡ç­¾
  - ğŸ”¥ **å¤šéŸ³å­—å‘éŸ³æ§åˆ¶**ï¼šå°†å¤šéŸ³å­—æ›¿æ¢ä¸ºæ‹¼éŸ³å³å¯
    - ç¤ºä¾‹ï¼š`[æˆ‘ä¹Ÿæƒ³è¿‡è¿‡è¿‡å„¿è¿‡è¿‡çš„ç”Ÿæ´»]` â†’ `[æˆ‘ä¹Ÿæƒ³guo4guo4guo1å„¿guo4guo4çš„ç”Ÿæ´»]`

- **æƒ…æ„Ÿå’Œè¯´è¯é£æ ¼ç¼–è¾‘**
  - æ”¯æŒæ•°åç§ç¼–è¾‘é€‰é¡¹çš„è¿­ä»£æ§åˆ¶
  - **æƒ…æ„Ÿç¼–è¾‘**ï¼šAngry, Happy, Sad, Excited, Fearful, Surprised, Disgusted ç­‰
  - **è¯´è¯é£æ ¼ç¼–è¾‘**ï¼šAct_coy, Older, Child, Whisper, Serious, Generous, Exaggerated ç­‰

- **å‰¯è¯­è¨€ç¼–è¾‘**
  - ç²¾ç¡®æ§åˆ¶ 10 ç§å‰¯è¯­è¨€ç‰¹å¾ï¼Œç”Ÿæˆæ›´è‡ªç„¶ã€äººæ€§åŒ–ã€å¯Œæœ‰è¡¨ç°åŠ›çš„åˆæˆéŸ³é¢‘
  - æ”¯æŒæ ‡ç­¾ï¼šBreathing, Laughter, Surprise-oh, Confirmation-en, Uhm, Surprise-ah, Surprise-wa, Sigh, Question-ei, Dissatisfaction-hnn

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç³»ç»Ÿè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚
- **GPU**: NVIDIA GPU with CUDA support
  - **æ¨èæ˜¾å­˜**: 16GB+ (æœ€ä½ 12GB)
  - **æµ‹è¯•ç¯å¢ƒ**: L40S GPU (48GB)
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨è Ubuntu 22.04+)
- **Docker**: å·²å®‰è£… Docker å’Œ nvidia-docker2

#### è½¯ä»¶è¦æ±‚
- Docker >= 20.10
- nvidia-docker2
- NVIDIA Container Toolkit
- Git LFS (ç”¨äºä¸‹è½½å¤§æ¨¡å‹æ–‡ä»¶)

### ğŸ“¦ å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®

```bash
# å…‹éš†ä»£ç ä»“åº“
git clone https://github.com/stepfun-ai/Step-Audio-EditX.git
cd Step-Audio-EditX

# å®‰è£… Git LFSï¼ˆç”¨äºä¸‹è½½å¤§æ¨¡å‹ï¼‰
git lfs install
```

#### 2. ä¸‹è½½æ¨¡å‹

##### æ–¹å¼ 1ï¼šä» HuggingFace ä¸‹è½½ï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p models
cd models

# ä¸‹è½½ Step-Audio-Tokenizer
git clone https://huggingface.co/stepfun-ai/Step-Audio-Tokenizer

# ä¸‹è½½ Step-Audio-EditX
git clone https://huggingface.co/stepfun-ai/Step-Audio-EditX

cd ..
```

##### æ–¹å¼ 2ï¼šä» ModelScope ä¸‹è½½ï¼ˆå›½å†…ç”¨æˆ·ï¼‰

```bash
# åˆ›å»ºæ¨¡å‹ç›®å½•
mkdir -p models
cd models

# ä¸‹è½½ Step-Audio-Tokenizer
git clone https://www.modelscope.cn/stepfun-ai/Step-Audio-Tokenizer.git Step-Audio-Tokenizer

# ä¸‹è½½ Step-Audio-EditX
git clone https://www.modelscope.cn/stepfun-ai/Step-Audio-EditX.git Step-Audio-EditX

cd ..
```

#### 3. æ„å»º Docker é•œåƒ

##### åŸºç¡€æ„å»º

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
docker build -t step-audio-editx:latest .
```

**æ„å»ºæ—¶é—´**: çº¦ 10-20 åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œé€Ÿåº¦ï¼‰

##### Dockerfile è¯´æ˜

é¡¹ç›®ä½¿ç”¨åŸºäº `nvidia/cuda:12.1.0-cudnn8-runtime-ubuntu22.04` çš„ Docker é•œåƒï¼ŒåŒ…å«ï¼š

- **åŸºç¡€ç¯å¢ƒ**ï¼š
  - Ubuntu 22.04
  - CUDA 12.1.0 + cuDNN 8
  - Python 3.10
  - å¿…è¦çš„ç³»ç»Ÿå·¥å…·ï¼ˆgit-lfs, curl, wget ç­‰ï¼‰

- **Python ä¾èµ–**ï¼š
  - PyTorch 2.8.0 (CUDA æ”¯æŒ)
  - Transformers 4.53.3
  - ONNX Runtime GPU 1.17.0
  - Gradio >= 5.16.0
  - FunASR >= 1.1.3
  - å…¶ä»–ä¾èµ–ï¼ˆè§ `requirements.txt`ï¼‰

- **ä¼˜åŒ–é…ç½®**ï¼š
  - æ—¶åŒºè®¾ç½®ä¸º Asia/Shanghai
  - é¢„å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…
  - ä¼˜åŒ–é•œåƒå±‚ç»“æ„

##### æ„å»ºéªŒè¯

æ„å»ºå®Œæˆåï¼ŒéªŒè¯é•œåƒï¼š

```bash
# æŸ¥çœ‹é•œåƒä¿¡æ¯
docker images | grep step-audio-editx

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# step-audio-editx   latest   <image-id>   <size>   <time>
```

##### æ„å»ºé€‰é¡¹

```bash
# ä½¿ç”¨æ„å»ºç¼“å­˜ï¼ˆæ¨èï¼ŒåŠ å¿«åç»­æ„å»ºï¼‰
docker build -t step-audio-editx:latest .

# ä¸ä½¿ç”¨ç¼“å­˜ï¼ˆå®Œå…¨é‡æ–°æ„å»ºï¼‰
docker build --no-cache -t step-audio-editx:latest .

# æŒ‡å®šæ„å»ºå‚æ•°
docker build \
  --build-arg PYTHON_VERSION=3.10 \
  -t step-audio-editx:latest .
```

##### é•œåƒå¤§å°

æ„å»ºå®Œæˆåï¼Œé•œåƒå¤§å°çº¦ä¸º **8-10GB**ï¼ˆåŒ…å«æ‰€æœ‰ä¾èµ–ï¼Œä½†ä¸åŒ…å«æ¨¡å‹æ–‡ä»¶ï¼‰ã€‚

**æ³¨æ„**ï¼šæ¨¡å‹æ–‡ä»¶é€šè¿‡ volume æŒ‚è½½ï¼Œä¸åŒ…å«åœ¨é•œåƒä¸­ã€‚

---

## ğŸ³ Docker é•œåƒè¯´æ˜

### é•œåƒä¿¡æ¯

- **åŸºç¡€é•œåƒ**: `nvidia/cuda:12.1.0-cudnn8-runtime-ubuntu22.04`
- **Python ç‰ˆæœ¬**: 3.10
- **CUDA ç‰ˆæœ¬**: 12.1.0
- **cuDNN ç‰ˆæœ¬**: 8
- **é•œåƒå¤§å°**: çº¦ 8-10GBï¼ˆä¸å«æ¨¡å‹ï¼‰

### é•œåƒå†…å®¹

#### ç³»ç»Ÿä¾èµ–
- Ubuntu 22.04 åŸºç¡€ç³»ç»Ÿ
- CUDA 12.1.0 + cuDNN 8 è¿è¡Œæ—¶
- Git LFSï¼ˆç”¨äºä¸‹è½½å¤§æ¨¡å‹ï¼‰
- å¿…è¦çš„ç³»ç»Ÿå·¥å…·ï¼ˆcurl, wget, vim ç­‰ï¼‰

#### Python ç¯å¢ƒ
- Python 3.10
- pip åŒ…ç®¡ç†å™¨
- æ‰€æœ‰é¡¹ç›®ä¾èµ–ï¼ˆè§ `requirements.txt`ï¼‰

#### é¢„è£…ä¼˜åŒ–
- âœ… TF32 åŠ é€Ÿæ”¯æŒ
- âœ… ONNX Runtime GPU æ”¯æŒ
- âœ… FunASR ç¼“å­˜æ”¯æŒ
- âœ… æ—¶åŒºé…ç½®ï¼ˆAsia/Shanghaiï¼‰

### Volume æŒ‚è½½è¯´æ˜

å®¹å™¨ä½¿ç”¨ä»¥ä¸‹ volume æŒ‚è½½ï¼š

| æŒ‚è½½ç‚¹ | å®¿ä¸»æœºè·¯å¾„ | å®¹å™¨å†…è·¯å¾„ | æƒé™ | è¯´æ˜ |
|-------|----------|----------|------|------|
| ä»£ç ç›®å½• | `$(pwd)` | `/app` | è¯»å†™ | é¡¹ç›®ä»£ç ï¼Œæ”¯æŒçƒ­æ›´æ–° |
| æ¨¡å‹ç›®å½• | `$(pwd)/models` | `/app/models` | åªè¯» | æ¨¡å‹æ–‡ä»¶ï¼Œé¿å…è¯¯ä¿®æ”¹ |
| ç¼“å­˜ç›®å½• | `$(pwd)/cache` | `/app/cache` | è¯»å†™ | FunASR ç¼“å­˜ï¼ŒæŒä¹…åŒ–å­˜å‚¨ |

**æ³¨æ„**ï¼šæ¨¡å‹æ–‡ä»¶ä¸åŒ…å«åœ¨é•œåƒä¸­ï¼Œå¿…é¡»é€šè¿‡ volume æŒ‚è½½ã€‚

---

## ğŸ¯ éƒ¨ç½²æ–¹å¼

### æ–¹å¼ä¸€ï¼šç»Ÿä¸€éƒ¨ç½²ï¼ˆæ¨èï¼‰â­â­â­â­â­

**ç‰¹ç‚¹**ï¼š
- âœ… UI + API åœ¨åŒä¸€ä¸ªå®¹å™¨
- âœ… å…±äº«åŒä¸€ä¸ªæ¨¡å‹å®ä¾‹
- âœ… èŠ‚çœ 50% æ˜¾å­˜å’Œèµ„æº
- âœ… ç»Ÿä¸€ç«¯å£è®¿é—®æ‰€æœ‰åŠŸèƒ½
- âœ… æ‰€æœ‰ä¼˜åŒ–åŠŸèƒ½å®Œæ•´ä¿ç•™

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
# 1. ç¼–è¾‘å¯åŠ¨è„šæœ¬
vim start_unified.sh

# ä¿®æ”¹é…ç½®ï¼š
#   PROJECT_DIR="/your/project/path"  # é¡¹ç›®è·¯å¾„
#   GPU_ID=2                          # GPU ID
#   PORT=7860                         # æœåŠ¡ç«¯å£

# 2. å¯åŠ¨å®¹å™¨
./start_unified.sh

# 3. è®¿é—®æœåŠ¡ï¼ˆç­‰å¾…3åˆ†é’Ÿï¼‰
# UI: http://localhost:7860
# API: http://localhost:7860/docs
# å¥åº·æ£€æŸ¥: http://localhost:7860/healthz
```

**èµ„æºå ç”¨**ï¼š
- å®¹å™¨æ•°ï¼š1ä¸ª
- æ¨¡å‹å®ä¾‹ï¼š1ä¸ª
- æ˜¾å­˜ï¼š~41GBï¼ˆå•å®ä¾‹ï¼‰
- ç«¯å£ï¼š1ä¸ª

**é€‚ç”¨åœºæ™¯**ï¼š
- âœ… éœ€è¦åŒæ—¶ä½¿ç”¨ UI å’Œ API
- âœ… èµ„æºå—é™ç¯å¢ƒ
- âœ… ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- âœ… æ¨èæ‰€æœ‰ç”¨æˆ·ä½¿ç”¨

---

### æ–¹å¼äºŒï¼šåˆ†ç¦»éƒ¨ç½²

é¡¹ç›®ä¹Ÿæ”¯æŒ UI å’Œ API åˆ†åˆ«éƒ¨ç½²ï¼ˆä¸æ¨èï¼Œèµ„æºå ç”¨é«˜ï¼‰ï¼š

| ç‰¹æ€§ | UI æ–¹å¼ | API æ–¹å¼ | ç»Ÿä¸€æ–¹å¼ï¼ˆæ¨èï¼‰ |
|-----|--------|---------|----------------|
| **é€‚ç”¨åœºæ™¯** | äº¤äº’å¼ä½¿ç”¨ã€æµ‹è¯• | é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿ | **æ‰€æœ‰åœºæ™¯** |
| **è®¿é—®æ–¹å¼** | Web æµè§ˆå™¨ | HTTP API |
| **å¯åŠ¨è„šæœ¬** | `app.py` | `api_server.py` |
| **ç«¯å£** | 7860 | 8000 (å¯è‡ªå®šä¹‰) |
| **åŠŸèƒ½** | å®Œæ•´ UI ç•Œé¢ | OpenAI å…¼å®¹ API |

### æ–¹å¼ä¸€ï¼šUI æ–¹å¼éƒ¨ç½²ï¼ˆGradio Web ç•Œé¢ï¼‰

#### ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„å¯åŠ¨è„šæœ¬ `start_ui_container.sh`ï¼š

```bash
# 1. ç¼–è¾‘å¯åŠ¨è„šæœ¬ï¼Œä¿®æ”¹é…ç½®
vim start_ui_container.sh

# ä¿®æ”¹ä»¥ä¸‹å˜é‡ï¼š
#   PROJECT_DIR="/your/project/path"  # é¡¹ç›®æ ¹ç›®å½•è·¯å¾„
#   GPU_ID=2                          # GPU ID (0, 1, 2, 3...)
#   UI_PORT=7860                      # å®¿ä¸»æœºç«¯å£

# 2. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x start_ui_container.sh

# 3. æ‰§è¡Œå¯åŠ¨
./start_ui_container.sh
```

**å¯åŠ¨è„šæœ¬åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨æ£€æŸ¥é¡¹ç›®ç›®å½•å’Œæ¨¡å‹ç›®å½•
- âœ… è‡ªåŠ¨æ£€æŸ¥å¹¶æ¸…ç†æ—§å®¹å™¨
- âœ… æ˜¾ç¤º GPU çŠ¶æ€ä¿¡æ¯
- âœ… æä¾›è¯¦ç»†çš„å¯åŠ¨åæŒ‡å¼•

#### æ‰‹åŠ¨å¯åŠ¨

å¦‚æœä¸æƒ³ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# è®¾ç½®å˜é‡ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
PROJECT_DIR="/your/project/path"  # é¡¹ç›®è·¯å¾„
GPU_ID=2                                          # GPU ID
UI_PORT=7860                                      # å®¿ä¸»æœºç«¯å£

# å¯åŠ¨å®¹å™¨
docker run -d \
  --name step-audio-ui-opt \
  --restart=always \
  --gpus '"device='${GPU_ID}'"' \
  -p ${UI_PORT}:7860 \
  -v ${PROJECT_DIR}:/app \
  -v ${PROJECT_DIR}/models:/app/models:ro \
  -v ${PROJECT_DIR}/cache:/app/cache \
  -e CUDA_VISIBLE_DEVICES=0 \
  -e PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True \
  step-audio-editx:latest \
  python app.py \
    --model-path /app/models/Step-Audio-EditX \
    --tokenizer-model-id /app/models/Step-Audio-Tokenizer \
    --model-source local \
    --enable-auto-transcribe \
    --server-name 0.0.0.0 \
    --server-port 7860
```

#### å¯åŠ¨å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | å¿…å¡« |
|-----|------|--------|------|
| `--name` | å®¹å™¨åç§° | `step-audio-ui-opt` | âœ… |
| `--restart` | é‡å¯ç­–ç•¥ | `always` | âœ… |
| `--gpus` | GPU è®¾å¤‡ | `device=2` | âœ… **å¿…é¡»ä¿®æ”¹** |
| `-p` | ç«¯å£æ˜ å°„ | `7860:7860` | âœ… **å¯ä¿®æ”¹å®¿ä¸»æœºç«¯å£** |
| `-v /app` | ä»£ç ç›®å½• | é¡¹ç›®æ ¹ç›®å½• | âœ… **å¿…é¡»ä¿®æ”¹** |
| `-v /app/models` | æ¨¡å‹ç›®å½• | `models/` | âœ… **å¿…é¡»ä¿®æ”¹** |
| `-v /app/cache` | ç¼“å­˜ç›®å½• | `cache/` | âœ… **å¿…é¡»ä¿®æ”¹** |
| `--model-path` | TTS æ¨¡å‹è·¯å¾„ | `/app/models/Step-Audio-EditX` | âŒ |
| `--tokenizer-model-id` | Tokenizer è·¯å¾„ | `/app/models/Step-Audio-Tokenizer` | âŒ |
| `--server-port` | å®¹å™¨å†…ç«¯å£ | `7860` | âŒ |

#### å¯åŠ¨éªŒè¯

å¯åŠ¨åï¼ŒéªŒè¯å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep step-audio-ui-opt
# åº”è¯¥çœ‹åˆ°: step-audio-ui-opt   Up X minutes   0.0.0.0:7860->7860/tcp

# 2. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼ˆç­‰å¾… 3 åˆ†é’Ÿï¼‰
docker logs -f step-audio-ui-opt
# çœ‹åˆ° "Running on local URL: http://0.0.0.0:7860" è¡¨ç¤ºå¯åŠ¨æˆåŠŸ

# 3. è®¿é—® Web ç•Œé¢
# æµè§ˆå™¨æ‰“å¼€: http://localhost:7860
```

#### è®¿é—®åœ°å€

- **Web ç•Œé¢**: http://localhost:7860

#### UI åŠŸèƒ½ç‰¹æ€§

##### æ ¸å¿ƒåŠŸèƒ½
- âœ… **é›¶æ ·æœ¬è¯­éŸ³å…‹éš†** - ä¸Šä¼ å‚è€ƒéŸ³é¢‘ï¼Œå…‹éš†å£°éŸ³
- âœ… **æƒ…æ„Ÿç¼–è¾‘** - æ”¯æŒ happy, sad, angry, fear ç­‰å¤šç§æƒ…æ„Ÿ
- âœ… **é£æ ¼ç¼–è¾‘** - æ”¯æŒ whisper, serious, child ç­‰å¤šç§é£æ ¼
- âœ… **å‰¯è¯­è¨€ç¼–è¾‘** - æ·»åŠ å‘¼å¸ã€ç¬‘å£°ã€å¹æ¯ç­‰è‡ªç„¶éŸ³æ•ˆ
- âœ… **è¯­é€Ÿæ§åˆ¶** - faster/slower è¯­é€Ÿè°ƒæ•´
- âœ… **é™å™ªå¤„ç†** - è‡ªåŠ¨å»é™¤èƒŒæ™¯å™ªéŸ³
- âœ… **VAD å¤„ç†** - è¯­éŸ³æ´»åŠ¨æ£€æµ‹å’Œåˆ†æ®µ

##### UI ä¼˜åŒ–åŠŸèƒ½
- âœ… **å®æ—¶ç¼“å­˜ç»Ÿè®¡é¢æ¿** - æŸ¥çœ‹ FunASR ç¼“å­˜å‘½ä¸­ç‡ã€èŠ‚çœæ—¶é—´
  - å‘½ä¸­æ¬¡æ•°ã€æœªå‘½ä¸­æ¬¡æ•°ã€æ€»è¯·æ±‚æ•°
  - ç¼“å­˜å‘½ä¸­ç‡ç™¾åˆ†æ¯”
  - é¢„ä¼°èŠ‚çœæ—¶é—´
  - ç¼“å­˜å¤§å°å’Œå®¹é‡
  - ä¸€é”®åˆ·æ–°å’Œæ¸…ç©ºç¼“å­˜
- âœ… **å®æ—¶è¿è¡Œæ—¥å¿—** - æŸ¥çœ‹è¯¦ç»†æ‰§è¡Œæ­¥éª¤
  - å¸¦æ—¶é—´æˆ³çš„æ‰§è¡Œæ—¥å¿—
  - è‡ªåŠ¨æ»šåŠ¨æ˜¾ç¤º
  - æ”¯æŒå¤åˆ¶å’Œæ¸…ç©º
  - è®°å½•å…³é”®æ“ä½œæ­¥éª¤ï¼ˆCLONE/EDITï¼‰
- âœ… **Model Variant é€‰æ‹©** - æ”¯æŒ base/awq/bnb ä¸‰ç§æ¨¡å‹
- âœ… **Intensity å‚æ•°æ§åˆ¶** - ç²¾ç»†æ§åˆ¶ç¼–è¾‘å¼ºåº¦ï¼ˆ0.1-3.0ï¼‰
- âœ… **Whisper ASR è‡ªåŠ¨è½¬å†™** - ä¸Šä¼ éŸ³é¢‘è‡ªåŠ¨è¯†åˆ«æ–‡æœ¬

### æ–¹å¼äºŒï¼šAPI æ–¹å¼éƒ¨ç½²ï¼ˆOpenAI å…¼å®¹ APIï¼‰

#### ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„å¯åŠ¨è„šæœ¬ `start_api_container.sh`ï¼š

```bash
# 1. ç¼–è¾‘å¯åŠ¨è„šæœ¬ï¼Œä¿®æ”¹é…ç½®
vim start_api_container.sh

# ä¿®æ”¹ä»¥ä¸‹å˜é‡ï¼š
#   PROJECT_DIR="/your/project/path"  # é¡¹ç›®æ ¹ç›®å½•è·¯å¾„
#   GPU_ID=3                          # GPU ID (0, 1, 2, 3...)
#   API_PORT=8003                     # å®¿ä¸»æœºç«¯å£

# 2. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x start_api_container.sh

# 3. æ‰§è¡Œå¯åŠ¨
./start_api_container.sh
```

**å¯åŠ¨è„šæœ¬åŠŸèƒ½**ï¼š
- âœ… è‡ªåŠ¨æ£€æŸ¥é¡¹ç›®ç›®å½•å’Œæ¨¡å‹ç›®å½•
- âœ… è‡ªåŠ¨æ£€æŸ¥å¹¶æ¸…ç†æ—§å®¹å™¨
- âœ… æ˜¾ç¤º GPU çŠ¶æ€ä¿¡æ¯
- âœ… æä¾›è¯¦ç»†çš„å¯åŠ¨åæŒ‡å¼•

#### æ‰‹åŠ¨å¯åŠ¨

å¦‚æœä¸æƒ³ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# è®¾ç½®å˜é‡ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼‰
PROJECT_DIR="/your/project/path"  # é¡¹ç›®è·¯å¾„
GPU_ID=3                                          # GPU ID
API_PORT=8003                                     # å®¿ä¸»æœºç«¯å£

# å¯åŠ¨å®¹å™¨
docker run -d \
  --name step-audio-api-opt \
  --restart=always \
  --gpus '"device='${GPU_ID}'"' \
  -p ${API_PORT}:8000 \
  -v ${PROJECT_DIR}:/app \
  -v ${PROJECT_DIR}/models:/app/models:ro \
  -v ${PROJECT_DIR}/cache:/app/cache \
  -e CUDA_VISIBLE_DEVICES=0 \
  -e PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True \
  -e OMP_NUM_THREADS=8 \
  -e MKL_NUM_THREADS=8 \
  step-audio-editx:latest \
  python api_server.py \
    --model-path /app/models \
    --model-source local \
    --enable-auto-transcribe \
    --api-host 0.0.0.0 \
    --api-port 8000
```

#### å¯åŠ¨å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | å¿…å¡« |
|-----|------|--------|------|
| `--name` | å®¹å™¨åç§° | `step-audio-api-opt` | âœ… |
| `--restart` | é‡å¯ç­–ç•¥ | `always` | âœ… |
| `--gpus` | GPU è®¾å¤‡ | `device=3` | âœ… **å¿…é¡»ä¿®æ”¹** |
| `-p` | ç«¯å£æ˜ å°„ | `8003:8000` | âœ… **å¯ä¿®æ”¹å®¿ä¸»æœºç«¯å£** |
| `-v /app` | ä»£ç ç›®å½• | é¡¹ç›®æ ¹ç›®å½• | âœ… **å¿…é¡»ä¿®æ”¹** |
| `-v /app/models` | æ¨¡å‹ç›®å½• | `models/` | âŒ |
| `-v /app/cache` | ç¼“å­˜ç›®å½• | `cache/` | âŒ |
| `--model-path` | **æ¨¡å‹æ ¹ç›®å½•** | `/app/models` | âŒ **æ³¨æ„ï¼šä¸ UI ä¸åŒï¼** |
| `--api-port` | å®¹å™¨å†…ç«¯å£ | `8000` | âŒ |

#### âš ï¸ é‡è¦ï¼šAPI ä¸ UI çš„è·¯å¾„å·®å¼‚

**å…³é”®åŒºåˆ«**ï¼š
- **UI å®¹å™¨**: `--model-path /app/models/Step-Audio-EditX`
- **API å®¹å™¨**: `--model-path /app/models` ï¼ˆ**å°‘ä¸€å±‚ç›®å½•ï¼**ï¼‰

è¿™æ˜¯å› ä¸º `api_server.py` ä¼šè‡ªåŠ¨æ‹¼æ¥å­ç›®å½•ï¼š
```python
tokenizer_path = base_dir / "Step-Audio-Tokenizer"  # /app/models/Step-Audio-Tokenizer
tts_path = base_dir / "Step-Audio-EditX"            # /app/models/Step-Audio-EditX
```

#### å¯åŠ¨éªŒè¯

å¯åŠ¨åï¼ŒéªŒè¯å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š

```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker ps | grep step-audio-api-opt
# åº”è¯¥çœ‹åˆ°: step-audio-api-opt   Up X minutes   0.0.0.0:8003->8000/tcp

# 2. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼ˆç­‰å¾… 3 åˆ†é’Ÿï¼‰
docker logs -f step-audio-api-opt
# çœ‹åˆ° "Uvicorn running on http://0.0.0.0:8000" è¡¨ç¤ºå¯åŠ¨æˆåŠŸ

# 3. æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8003/healthz
# åº”è¯¥è¿”å›: {"status":"ok"}

# 4. æŸ¥çœ‹ API æ–‡æ¡£
# æµè§ˆå™¨æ‰“å¼€: http://localhost:8003/docs
```

#### è®¿é—®åœ°å€

- **å¥åº·æ£€æŸ¥**: http://localhost:8003/healthz
- **Swagger UI**: http://localhost:8003/docs
- **ReDoc**: http://localhost:8003/redoc
- **API ç«¯ç‚¹**: http://localhost:8003/v1/audio/speech

#### API ç«¯ç‚¹è¯´æ˜

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|-----|------|------|
| `/healthz` | GET | å¥åº·æ£€æŸ¥ |
| `/v1/models` | GET | è·å–æ¨¡å‹åˆ—è¡¨ |
| `/v1/voices` | GET | è·å–é¢„è®¾å£°éŸ³åˆ—è¡¨ |
| `/v1/tags` | GET | è·å–æ”¯æŒçš„æ ‡ç­¾åˆ—è¡¨ |
| `/v1/audio/speech` | POST | **æ ¸å¿ƒç«¯ç‚¹ï¼šç”ŸæˆéŸ³é¢‘** |
| `/docs` | GET | Swagger UI æ–‡æ¡£ |
| `/redoc` | GET | ReDoc æ–‡æ¡£ |

#### API ä½¿ç”¨ç¤ºä¾‹

```bash
# ä½¿ç”¨é¢„è®¾å£°éŸ³å…‹éš†
curl -X POST http://localhost:8003/v1/audio/speech \
  -H "Content-Type: application/json" \
  -d '{
    "model": "step-audio-editx",
    "voice": "happy_en",
    "input": "Hello! This is a test.",
    "response_format": "wav",
    "step_audio": {
      "mode": "clone",
      "model_variant": "base",
      "intensity": 1.0
    }
  }' \
  --output output.wav
```

è¯¦ç»† API æ–‡æ¡£è¯·å‚è€ƒï¼š[API ä½¿ç”¨æŒ‡å—](docs/api-guide.md)

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ä¼˜åŒ–æˆæœ

é€šè¿‡ä¸€ç³»åˆ—æ€§èƒ½ä¼˜åŒ–ï¼Œæˆ‘ä»¬å°†å¤„ç†æ—¶é—´ä» **24s ä¼˜åŒ–åˆ° 8s**ï¼ˆç¼“å­˜å‘½ä¸­æ—¶ï¼‰ï¼Œ**æé€Ÿ 3x**ï¼š

| é˜¶æ®µ | è€—æ—¶ | æå‡ | è¯´æ˜ |
|------|------|------|------|
| **åŸå§‹åŸºçº¿** | 24s | - | æœªä¼˜åŒ– |
| **TF32 + ONNX** | 17s | +29% | é¦–è½®ä¼˜åŒ– |
| **é¦–æ¬¡è¿è¡Œï¼ˆæ— ç¼“å­˜ï¼‰** | 12s | +50% | æŒä¹…åŒ–ç¼“å­˜å†™å…¥ |
| **ç¼“å­˜å‘½ä¸­** | **8s** | **+66%** | **æœ€ä¼˜æ€§èƒ½** âœ… |

### å·²å®ç°çš„ä¼˜åŒ–

#### 1. FunASR æŒä¹…åŒ–ç¼“å­˜ â­â­â­â­â­

- **æ•ˆæœ**ï¼šç¼“å­˜å‘½ä¸­æ—¶ä» 12s é™è‡³ 8sï¼Œ**æé€Ÿ 33%**
- **å®ç°ä½ç½®**ï¼š`tokenizer.py` çš„ `wav2token()` æ–¹æ³•
- **ç‰¹æ€§**ï¼š
  - âœ… **æŒä¹…åŒ–å­˜å‚¨**ï¼ˆ`/app/cache/funasr/`ï¼‰
  - âœ… **LRU è‡ªåŠ¨æ·˜æ±°**ï¼ˆé»˜è®¤å®¹é‡ 1000 é¡¹ï¼‰
  - âœ… **é‡å¯åä¿ç•™**ï¼ˆå®¹å™¨é‡å¯ä¸ä¸¢å¤±ï¼‰
  - âœ… **åˆ‡æ¢éŸ³é¢‘åä»å¯å‘½ä¸­**ï¼ˆå¤šéŸ³é¢‘åœºæ™¯ï¼‰
  - âœ… **MD5 å“ˆå¸Œç´¢å¼•**ï¼ˆå¿«é€ŸæŸ¥æ‰¾ï¼‰
  - âœ… **JSON æ ¼å¼å­˜å‚¨**ï¼ˆæ˜“äºè°ƒè¯•ï¼‰
- **ç¼“å­˜é€»è¾‘**ï¼š
  ```python
  # 1. è®¡ç®—éŸ³é¢‘å“ˆå¸Œ
  audio_hash = self._compute_audio_hash(audio)
  
  # 2. æ£€æŸ¥ç¼“å­˜
  cached_result = self._cache_get(audio_hash)
  if cached_result:
      return cached_result  # å‘½ä¸­ï¼Œç›´æ¥è¿”å›
  
  # 3. æœªå‘½ä¸­ï¼Œæ‰§è¡Œç¼–ç å¹¶ç¼“å­˜
  result = encode_audio(audio)
  self._cache_set(audio_hash, result)
  return result
  ```
- **æ€§èƒ½æ•°æ®**ï¼š
  - é¦–æ¬¡ç¼–ç ï¼š~4.8s
  - ç¼“å­˜å‘½ä¸­ï¼š~0.006sï¼ˆ**æé€Ÿ 800x**ï¼‰
  - æ€»æµç¨‹ï¼šä» 12s â†’ 8sï¼ˆèŠ‚çœ 4sï¼‰

#### 2. TF32 åŠ é€Ÿ â­

- **æ•ˆæœ**ï¼šæå‡ 10-20% æ€§èƒ½
- **å®ç°ä½ç½®**ï¼š`model_loader.py` å’Œ `api_server.py`
- **åŸç†**ï¼šå¯ç”¨ Ampere GPU çš„ TensorFloat-32 åŠ é€Ÿ
- **é…ç½®**ï¼š
  ```python
  torch.backends.cuda.matmul.allow_tf32 = True
  torch.backends.cudnn.allow_tf32 = True
  ```

#### 3. ONNX Runtime ä¼˜åŒ– â­â­

- **æ•ˆæœ**ï¼šæå‡ 10-30% æ€§èƒ½
- **å®ç°ä½ç½®**ï¼š`tokenizer.py` çš„ ONNX Session é…ç½®
- **æ”¹è¿›**ï¼š
  - çº¿ç¨‹æ•°ä¼˜åŒ–ï¼š1 â†’ 4ï¼ˆ`intra_op_num_threads`ï¼‰
  - å¹¶è¡Œæ‰§è¡Œæ¨¡å¼ï¼ˆ`execution_mode`ï¼‰
  - å›¾ä¼˜åŒ–çº§åˆ«ï¼šENABLE_ALL
  - CUDA Graph è‡ªåŠ¨åˆå§‹åŒ–

#### 4. è¯¦ç»†æ€§èƒ½æ—¥å¿— â­â­

- **åŠŸèƒ½**ï¼šç²¾ç¡®è¯Šæ–­æ€§èƒ½ç“¶é¢ˆ
- **å®ç°ä½ç½®**ï¼š`tokenizer.py` å’Œ `app.py`
- **è¾“å‡º**ï¼šæ¯ä¸ªé˜¶æ®µçš„è€—æ—¶åˆ†è§£
  - FunASR ç¼–ç æ—¶é—´
  - LLM ç”Ÿæˆæ—¶é—´
  - éŸ³é¢‘è§£ç æ—¶é—´
  - ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­çŠ¶æ€

### æ€§èƒ½ç›‘æ§

UI ç•Œé¢æä¾›å®æ—¶æ€§èƒ½ç›‘æ§ï¼š

#### ç¼“å­˜ç»Ÿè®¡é¢æ¿

åœ¨ UI å³ä¾§çš„ "ğŸ“Š FunASR ç¼“å­˜ç»Ÿè®¡" é¢æ¿ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ï¼š

- **ç¼“å­˜çŠ¶æ€**ï¼šå¯ç”¨/ç¦ç”¨çŠ¶æ€
- **ç»Ÿè®¡æ•°æ®**ï¼š
  - å‘½ä¸­æ¬¡æ•°ï¼ˆCache HITï¼‰
  - æœªå‘½ä¸­æ¬¡æ•°ï¼ˆCache MISSï¼‰
  - æ€»è¯·æ±‚æ•°
  - å‘½ä¸­ç‡ç™¾åˆ†æ¯”
- **ç¼“å­˜ä½¿ç”¨**ï¼š
  - å½“å‰ç¼“å­˜é¡¹æ•°
  - æœ€å¤§å®¹é‡ï¼ˆé»˜è®¤ 1000 é¡¹ï¼‰
- **æ€§èƒ½æå‡**ï¼š
  - é¢„ä¼°èŠ‚çœæ—¶é—´
  - æ¯æ¬¡å‘½ä¸­èŠ‚çœçº¦ 1.65s
- **æ“ä½œæŒ‰é’®**ï¼š
  - ğŸ”„ åˆ·æ–°ç»Ÿè®¡ï¼šç«‹å³æ›´æ–°ç»Ÿè®¡æ•°æ®
  - ğŸ—‘ï¸ æ¸…ç©ºç¼“å­˜ï¼šæ¸…ç©ºæ‰€æœ‰ç¼“å­˜å¹¶é‡ç½®ç»Ÿè®¡

#### å®æ—¶æ—¥å¿—é¢æ¿

åœ¨ UI å³ä¾§çš„ "ğŸ“‹ å®æ—¶è¿è¡Œæ—¥å¿—" é¢æ¿ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹ï¼š

- **æ‰§è¡Œæ—¥å¿—**ï¼šå¸¦æ—¶é—´æˆ³çš„è¯¦ç»†æ‰§è¡Œæ­¥éª¤
- **è‡ªåŠ¨æ›´æ–°**ï¼šCLONE/EDIT æ“ä½œåè‡ªåŠ¨æ›´æ–°
- **æ—¥å¿—å†…å®¹**ï¼š
  - æ“ä½œå¼€å§‹/ç»“æŸæ—¶é—´
  - æ¨¡å‹å’Œå¼ºåº¦å‚æ•°
  - è¾“å…¥éªŒè¯çŠ¶æ€
  - æ‰§è¡Œè€—æ—¶
  - é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰
- **æ“ä½œæŒ‰é’®**ï¼š
  - ğŸ”„ åˆ·æ–°æ—¥å¿—ï¼šæŸ¥çœ‹æœ€æ–°æ—¥å¿—
  - ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—ï¼šæ¸…ç©ºæ‰€æœ‰æ—¥å¿—è®°å½•

### è¿›ä¸€æ­¥ä¼˜åŒ–å»ºè®®

#### é˜¶æ®µ 1ï¼šå¿«é€Ÿä¼˜åŒ–ï¼ˆç«‹å³å¯åšï¼‰â­â­â­â­â­

**é¢„æœŸæ•ˆæœ**ï¼šä» 24s â†’ 12sï¼ˆæé€Ÿ 50%ï¼‰

1. **ä½¿ç”¨è½»é‡ FunASR æ¨¡å‹**
   - ä» `paraformer-large` åˆ‡æ¢åˆ° `paraformer-base`
   - é¢„æœŸï¼šFunASR ç¼–ç ä» 20s â†’ 8sï¼ˆæé€Ÿ 2.5xï¼‰
   - å·¥ä½œé‡ï¼š15 åˆ†é’Ÿ

2. **Torch Compile ä¼˜åŒ–**
   - å¯ç”¨ PyTorch 2.0+ çš„ç¼–è¯‘ä¼˜åŒ–
   - é¢„æœŸï¼šé¢å¤–æé€Ÿ 10-15%
   - å·¥ä½œé‡ï¼š5 åˆ†é’Ÿ

#### é˜¶æ®µ 2ï¼šæ·±åº¦ä¼˜åŒ–ï¼ˆè¿›ä¸€æ­¥æå‡ï¼‰â­â­â­â­â­

**é¢„æœŸæ•ˆæœ**ï¼šä» 12s â†’ 10sï¼ˆå†æé€Ÿ 17%ï¼‰

1. **ONNX + TensorRT ä¼˜åŒ–**
   - å°† FunASR æ¨¡å‹è½¬æ¢ä¸º ONNX + TensorRT
   - é¢„æœŸï¼šFunASR ç¼–ç ä» 8s â†’ 6sï¼ˆæé€Ÿ 1.3xï¼‰
   - å·¥ä½œé‡ï¼š1-2 å‘¨

è¯¦ç»†ä¼˜åŒ–æŒ‡å—è¯·å‚è€ƒï¼š[æ€§èƒ½ä¼˜åŒ–å®Œæ•´æŒ‡å—](docs/funasr-optimization-guide.md)

---

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

#### UI å®¹å™¨ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | æ¨èå€¼ |
|-------|------|--------|--------|
| `CUDA_VISIBLE_DEVICES` | å®¹å™¨å†…å¯è§çš„ GPU | `0` | `0` |
| `PYTORCH_CUDA_ALLOC_CONF` | PyTorch å†…å­˜åˆ†é… | `expandable_segments:True` | âœ… æ¨è |

#### API å®¹å™¨ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ | æ¨èå€¼ |
|-------|------|--------|--------|
| `CUDA_VISIBLE_DEVICES` | å®¹å™¨å†…å¯è§çš„ GPU | `0` | `0` |
| `PYTORCH_CUDA_ALLOC_CONF` | PyTorch å†…å­˜åˆ†é… | `expandable_segments:True` | âœ… æ¨è |
| `OMP_NUM_THREADS` | OpenMP çº¿ç¨‹æ•° | `8` | æ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ |
| `MKL_NUM_THREADS` | MKL çº¿ç¨‹æ•° | `8` | æ ¹æ® CPU æ ¸å¿ƒæ•°è°ƒæ•´ |

### Model Variant é€‰æ‹©

| å˜ä½“ | è¯´æ˜ | æ˜¾å­˜å ç”¨ | æ€§èƒ½ | æ¨èåœºæ™¯ |
|------|------|---------|------|---------|
| `base` | æ ‡å‡†æ¨¡å‹ | 12GB+ | æœ€ä½³ | è¿½æ±‚æœ€é«˜éŸ³è´¨ |
| `awq` | AWQ 4-bit é‡åŒ– | 8GB+ | è¾ƒæ…¢ | æ˜¾å­˜å—é™ |
| `bnb` | BitsAndBytes 4-bit | 8GB+ | **ä¸ base ç›¸åŒ** | **æ¨è**ï¼ˆçœ 56% ç£ç›˜ï¼‰ |

**å…³é”®å‘ç°**ï¼šBnB å’Œ Base å®é™…ä½¿ç”¨é€Ÿåº¦**å®Œå…¨ç›¸åŒ**ï¼ˆéƒ½æ˜¯ 24sï¼‰ï¼Œä½† BnB èŠ‚çœ 56% ç£ç›˜ç©ºé—´ã€‚

**åŸå› åˆ†æ**ï¼š
- LLM ç”Ÿæˆåªå æ€»æ—¶é—´çš„ 8%ï¼ˆ~2sï¼‰
- éŸ³é¢‘ç¼–ç ï¼ˆFunASRï¼‰å  83%ï¼ˆ~20sï¼‰ï¼Œä¸å—é‡åŒ–å½±å“
- é‡åŒ–åªå½±å“ LLM éƒ¨åˆ†ï¼Œä½†å½±å“è¢«ç¼–ç æ—¶é—´æ·¹æ²¡
- å› æ­¤ BnB å’Œ Base å®é™…ä½¿ç”¨é€Ÿåº¦ç›¸åŒï¼Œä½† BnB èŠ‚çœå¤§é‡ç£ç›˜ç©ºé—´

### Intensity å‚æ•°

- **èŒƒå›´**ï¼š0.1 - 3.0
- **é»˜è®¤å€¼**ï¼š1.0
- **è¯´æ˜**ï¼š
  - `0.1`ï¼šæœ€å¼±æ•ˆæœ
  - `1.0`ï¼šæ ‡å‡†æ•ˆæœ
  - `3.0`ï¼šæœ€å¼ºæ•ˆæœ

---

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. å®¹å™¨å¯åŠ¨å¤±è´¥ï¼š`FileNotFoundError: Tokenizer directory missing`

**åŸå› **ï¼šæ¨¡å‹è·¯å¾„é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- **UI å®¹å™¨**ï¼šç¡®ä¿ `--model-path /app/models/Step-Audio-EditX` å’Œ `--tokenizer-model-id /app/models/Step-Audio-Tokenizer`
- **API å®¹å™¨**ï¼šç¡®ä¿ `--model-path /app/models`ï¼ˆ**æ³¨æ„ï¼šå°‘ä¸€å±‚ç›®å½•ï¼**ï¼‰

#### 2. æ˜¾å­˜ä¸è¶³ï¼š`CUDA out of memory`

**åŸå› **ï¼šGPU æ˜¾å­˜ä¸è¶³ 12GB

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨é‡åŒ–æ¨¡å‹ï¼ˆ`model_variant: "awq"` æˆ– `"bnb"`ï¼‰
2. å…³é—­å…¶ä»–å ç”¨æ˜¾å­˜çš„ç¨‹åº
3. ä½¿ç”¨æ˜¾å­˜æ›´å¤§çš„ GPU

#### 3. ç«¯å£è¢«å ç”¨ï¼š`bind: address already in use`

**åŸå› **ï¼šç«¯å£å·²è¢«å…¶ä»–ç¨‹åºå ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :7860  # UI ç«¯å£
sudo lsof -i :8003  # API ç«¯å£

# æ–¹æ¡ˆ 1ï¼šä¿®æ”¹å¯åŠ¨è„šæœ¬ä¸­çš„ç«¯å£
# æ–¹æ¡ˆ 2ï¼šåœæ­¢å ç”¨ç«¯å£çš„ç¨‹åº
```

#### 4. ç¼“å­˜ä¸å·¥ä½œï¼šç¼“å­˜å‘½ä¸­ç‡å§‹ç»ˆä¸º 0

**åŸå› **ï¼šç¼“å­˜ç›®å½•æƒé™é—®é¢˜æˆ–è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç¼“å­˜ç›®å½•
docker exec step-audio-ui-opt ls -la /app/cache
docker exec step-audio-api-opt ls -la /app/cache

# æ£€æŸ¥æƒé™
docker exec step-audio-ui-opt ls -ld /app/cache
# åº”è¯¥å¯å†™

# æŸ¥çœ‹ç¼“å­˜æ—¥å¿—
docker logs step-audio-ui-opt 2>&1 | grep -E "Cache (HIT|MISS)"
```

### è°ƒè¯•æŠ€å·§

#### è¿›å…¥å®¹å™¨è°ƒè¯•

```bash
# è¿›å…¥ UI å®¹å™¨
docker exec -it step-audio-ui-opt bash

# è¿›å…¥ API å®¹å™¨
docker exec -it step-audio-api-opt bash

# åœ¨å®¹å™¨å†…æ£€æŸ¥
python --version
nvidia-smi
ls -la /app/models/
ls -la /app/cache/
```

#### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker logs -f step-audio-ui-opt
docker logs -f step-audio-api-opt

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
docker logs --tail 100 step-audio-ui-opt

# æŸ¥çœ‹ç¼“å­˜ç›¸å…³æ—¥å¿—
docker logs step-audio-api-opt 2>&1 | grep -E "Cache (HIT|MISS)"

# æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
docker logs step-audio-ui-opt 2>&1 | grep -E "TF32|Cache|Running on"
```

#### å®¹å™¨ç®¡ç†

```bash
# æŸ¥çœ‹æ‰€æœ‰ Step-Audio å®¹å™¨
docker ps | grep step-audio

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker inspect step-audio-ui-opt
docker inspect step-audio-api-opt

# é‡å¯å®¹å™¨
docker restart step-audio-ui-opt
docker restart step-audio-api-opt

# åœæ­¢å®¹å™¨
docker stop step-audio-ui-opt
docker stop step-audio-api-opt

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker stop step-audio-ui-opt && docker rm step-audio-ui-opt
docker stop step-audio-api-opt && docker rm step-audio-api-opt

# æ›´æ–°ä»£ç ï¼ˆä»£ç ç›®å½•æ˜¯æŒ‚è½½çš„ï¼Œä¿®æ”¹åéœ€è¦é‡å¯å®¹å™¨ï¼‰
docker restart step-audio-ui-opt
docker restart step-audio-api-opt
```

#### é•œåƒç®¡ç†

```bash
# æŸ¥çœ‹é•œåƒ
docker images | grep step-audio-editx

# åˆ é™¤é•œåƒ
docker rmi step-audio-editx:latest

# å¯¼å‡ºé•œåƒï¼ˆå¤‡ä»½ï¼‰
docker save step-audio-editx:latest | gzip > step-audio-editx-latest.tar.gz

# å¯¼å…¥é•œåƒï¼ˆæ¢å¤ï¼‰
gunzip -c step-audio-editx-latest.tar.gz | docker load
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### æ¨¡å‹é€‰æ‹©å»ºè®®

åŸºäºå®é™…æµ‹è¯•ï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹æ¨¡å‹é…ç½®ï¼š

| åœºæ™¯ | æ¨èæ¨¡å‹ | ç†ç”± |
|------|---------|------|
| **ç”Ÿäº§ç¯å¢ƒï¼ˆé»˜è®¤ï¼‰** | `bnb` | é€Ÿåº¦ä¸ base ç›¸åŒï¼ˆ24sï¼‰ï¼ŒèŠ‚çœ 56% ç£ç›˜ç©ºé—´ |
| **è¿½æ±‚æœ€é«˜ç¨³å®šæ€§** | `base` | æ— é‡åŒ–ï¼Œæœ€ç¨³å®šï¼Œä½†å ç”¨ 16GB ç£ç›˜ |
| **æ˜¾å­˜å—é™** | `bnb` | æ˜¾å­˜å ç”¨æ›´ä½ï¼Œæ€§èƒ½æ— æŸå¤± |
| **é¿å…ä½¿ç”¨** | `awq` | æ…¢ 42%ï¼ˆ34s vs 24sï¼‰ï¼Œæ— ä¼˜åŠ¿ |

**å…³é”®å‘ç°**ï¼š
- BnB å’Œ Base å®é™…ä½¿ç”¨é€Ÿåº¦**å®Œå…¨ç›¸åŒ**ï¼ˆéƒ½æ˜¯ 24sï¼‰
- åŸå› ï¼šLLM åªå  8% æ—¶é—´ï¼ŒéŸ³é¢‘ç¼–ç ï¼ˆ83%ï¼‰ä¸å—é‡åŒ–å½±å“
- **BnB æ˜¯æœ€ä½³é€‰æ‹©**ï¼šé€Ÿåº¦ = Base + çœ 56% ç£ç›˜

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. å¯ç”¨ FunASR ç¼“å­˜ï¼ˆå¼ºçƒˆæ¨èï¼‰â­â­â­â­â­

**æ•ˆæœ**ï¼šç¼“å­˜å‘½ä¸­æ—¶ä» 24s é™è‡³ 8sï¼Œ**æé€Ÿ 3x**

**é€‚ç”¨åœºæ™¯**ï¼š
- å›ºå®šéŸ³è‰²æ‰¹é‡ç”Ÿæˆ
- å¤šæ¬¡ç¼–è¾‘åŒä¸€éŸ³é¢‘
- API æ‰¹é‡è¯·æ±‚

**ä½¿ç”¨æ–¹æ³•**ï¼š
- ç¼“å­˜å·²é»˜è®¤å¯ç”¨ï¼Œæ— éœ€é¢å¤–é…ç½®
- åœ¨ UI ä¸­æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡é¢æ¿äº†è§£å‘½ä¸­ç‡
- ä½¿ç”¨ç›¸åŒéŸ³é¢‘æ—¶è‡ªåŠ¨å‘½ä¸­ç¼“å­˜

#### 2. ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰â­â­â­â­â­

é¡¹ç›®æä¾›äº†ä¾¿æ·çš„å¯åŠ¨è„šæœ¬ï¼š
- `start_ui_container.sh` - UI å®¹å™¨å¯åŠ¨
- `start_api_container.sh` - API å®¹å™¨å¯åŠ¨

**ä¼˜åŠ¿**ï¼š
- è‡ªåŠ¨æ£€æŸ¥é…ç½®å’Œä¾èµ–
- è‡ªåŠ¨æ¸…ç†æ—§å®¹å™¨
- æ˜¾ç¤º GPU çŠ¶æ€ä¿¡æ¯
- æä¾›è¯¦ç»†å¯åŠ¨æŒ‡å¼•

#### 3. GPU é€‰æ‹©å»ºè®®

**æ£€æŸ¥å¯ç”¨ GPU**ï¼š
```bash
nvidia-smi
```

**é€‰æ‹©åŸåˆ™**ï¼š
- é€‰æ‹©æ˜¾å­˜å……è¶³ä¸”ç©ºé—²çš„ GPU
- é¿å…ä¸å…¶ä»–æœåŠ¡å…±äº« GPUï¼ˆå¯èƒ½å¯¼è‡´ OOMï¼‰
- æ¨èæ˜¾å­˜ï¼š16GB+ï¼ˆæœ€ä½ 12GBï¼‰

**é…ç½®ç¤ºä¾‹**ï¼š
```bash
# åœ¨å¯åŠ¨è„šæœ¬ä¸­ä¿®æ”¹ GPU_ID
GPU_ID=2  # ä½¿ç”¨ GPU 2
```

### Docker éƒ¨ç½²å»ºè®®

#### 1. ä½¿ç”¨ Volume æŒ‚è½½ï¼ˆæ¨èï¼‰

**ä¼˜åŠ¿**ï¼š
- ä»£ç ä¿®æ”¹åæ— éœ€é‡å»ºé•œåƒ
- æ¨¡å‹æ–‡ä»¶ç‹¬ç«‹ç®¡ç†
- ç¼“å­˜æŒä¹…åŒ–å­˜å‚¨

**é…ç½®**ï¼š
```bash
-v ${PROJECT_DIR}:/app              # ä»£ç ç›®å½•ï¼ˆè¯»å†™ï¼‰
-v ${PROJECT_DIR}/models:/app/models:ro  # æ¨¡å‹ç›®å½•ï¼ˆåªè¯»ï¼‰
-v ${PROJECT_DIR}/cache:/app/cache       # ç¼“å­˜ç›®å½•ï¼ˆè¯»å†™ï¼‰
```

#### 2. å®¹å™¨é‡å¯ç­–ç•¥

**æ¨èé…ç½®**ï¼š
```bash
--restart=always  # å®¹å™¨å¼‚å¸¸é€€å‡ºæ—¶è‡ªåŠ¨é‡å¯
```

#### 3. ç¯å¢ƒå˜é‡ä¼˜åŒ–

**æ¨èè®¾ç½®**ï¼š
```bash
-e CUDA_VISIBLE_DEVICES=0
-e PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True
-e OMP_NUM_THREADS=8  # API å®¹å™¨
-e MKL_NUM_THREADS=8  # API å®¹å™¨
```

### API ä½¿ç”¨å»ºè®®

#### 1. æ¨¡å‹å˜ä½“é€‰æ‹©

**æ¨èé…ç½®**ï¼š
```json
{
  "step_audio": {
    "model_variant": "bnb"  // é»˜è®¤æ¨è
  }
}
```

#### 2. Intensity å‚æ•°è°ƒèŠ‚

**ä½¿ç”¨å»ºè®®**ï¼š
- `0.1-0.5`ï¼šè½»å¾®æ•ˆæœï¼Œé€‚åˆå¾®è°ƒ
- `1.0`ï¼šæ ‡å‡†æ•ˆæœï¼ˆé»˜è®¤ï¼‰
- `1.5-2.0`ï¼šæ˜æ˜¾æ•ˆæœï¼Œé€‚åˆå¼ºè°ƒ
- `2.5-3.0`ï¼šå¼ºçƒˆæ•ˆæœï¼Œé€‚åˆæˆå‰§åŒ–åœºæ™¯

#### 3. éŸ³é¢‘è¾“å…¥æ–¹å¼

**ä¼˜å…ˆçº§**ï¼š
1. **URL æ–¹å¼**ï¼ˆæ¨èï¼‰ï¼š`input_audio_url` - é€‚åˆå¤§æ–‡ä»¶
2. **Base64 æ–¹å¼**ï¼š`input_audio_base64` - é€‚åˆå°æ–‡ä»¶
3. **æ–‡ä»¶ä¸Šä¼ **ï¼š`/v1/audio/speech/upload` - é€‚åˆè¡¨å•æäº¤

#### 4. é”™è¯¯å¤„ç†

**å¸¸è§é”™è¯¯åŠå¤„ç†**ï¼š
- `CUDA out of memory`ï¼šåˆ‡æ¢åˆ° `bnb` æ¨¡å‹æˆ–ä½¿ç”¨å…¶ä»– GPU
- `FileNotFoundError`ï¼šæ£€æŸ¥æ¨¡å‹è·¯å¾„é…ç½®
- `Whisper è½¬å†™å¤±è´¥`ï¼šæ˜¾å¼æä¾› `audio_text` å‚æ•°

### ç¼“å­˜ä½¿ç”¨æœ€ä½³å®è·µ

#### 1. æé«˜ç¼“å­˜å‘½ä¸­ç‡

**æ–¹æ³•**ï¼š
- ä½¿ç”¨é¢„è®¾éŸ³è‰²ï¼ˆ`voice` å‚æ•°ï¼‰
- å¤ç”¨ç›¸åŒçš„å‚è€ƒéŸ³é¢‘
- æ‰¹é‡å¤„ç†æ—¶ä½¿ç”¨ç›¸åŒ prompt

**é¢„æœŸæ•ˆæœ**ï¼š
- é¦–æ¬¡è¯·æ±‚ï¼š24sï¼ˆæ— ç¼“å­˜ï¼‰
- åç»­è¯·æ±‚ï¼š8sï¼ˆç¼“å­˜å‘½ä¸­ï¼‰âœ…

#### 2. ç¼“å­˜ç®¡ç†

**æŸ¥çœ‹ç»Ÿè®¡**ï¼š
- UI ç•Œé¢ï¼šå³ä¾§"FunASR ç¼“å­˜ç»Ÿè®¡"é¢æ¿
- APIï¼šé€šè¿‡æ—¥å¿—æŸ¥çœ‹ç¼“å­˜å‘½ä¸­æƒ…å†µ

**æ¸…ç©ºç¼“å­˜**ï¼š
- UIï¼šç‚¹å‡»"æ¸…ç©ºç¼“å­˜"æŒ‰é’®
- æ‰‹åŠ¨ï¼šåˆ é™¤ `cache/funasr/` ç›®å½•

### å¼€å‘ä¸è°ƒè¯•å»ºè®®

#### 1. æ—¥å¿—æŸ¥çœ‹

**å®æ—¶æ—¥å¿—**ï¼š
```bash
# UI å®¹å™¨
docker logs -f step-audio-ui-opt

# API å®¹å™¨
docker logs -f step-audio-api-opt
```

**è¿‡æ»¤ç‰¹å®šæ—¥å¿—**ï¼š
```bash
# æŸ¥çœ‹ç¼“å­˜ç›¸å…³
docker logs step-audio-ui-opt 2>&1 | grep -E "Cache (HIT|MISS)"

# æŸ¥çœ‹é”™è¯¯
docker logs step-audio-api-opt 2>&1 | grep -i error
```

#### 2. æ€§èƒ½ç›‘æ§

**UI ç•Œé¢**ï¼š
- å®æ—¶è¿è¡Œæ—¥å¿—é¢æ¿
- FunASR ç¼“å­˜ç»Ÿè®¡é¢æ¿
- æ‰§è¡Œè€—æ—¶è‡ªåŠ¨è®°å½•

**API ç›‘æ§**ï¼š
- å¥åº·æ£€æŸ¥ï¼š`GET /healthz`
- æŸ¥çœ‹ API æ–‡æ¡£ï¼š`GET /docs`

#### 3. ä»£ç çƒ­æ›´æ–°

**ä¼˜åŠ¿**ï¼š
- ä»£ç ç›®å½•é€šè¿‡ volume æŒ‚è½½
- ä¿®æ”¹ä»£ç ååªéœ€é‡å¯å®¹å™¨
- æ— éœ€é‡å»ºé•œåƒ

**æ“ä½œ**ï¼š
```bash
docker restart step-audio-ui-opt
docker restart step-audio-api-opt
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®

#### 1. å®‰å…¨é…ç½®

**æ¨èæªæ–½**ï¼š
- ä½¿ç”¨åå‘ä»£ç†ï¼ˆNginx/Traefikï¼‰
- é…ç½® HTTPS
- è®¾ç½® API è®¤è¯ï¼ˆå¦‚éœ€è¦ï¼‰
- é™åˆ¶è®¿é—® IPï¼ˆå¦‚éœ€è¦ï¼‰

#### 2. èµ„æºç›‘æ§

**ç›‘æ§æŒ‡æ ‡**ï¼š
- GPU æ˜¾å­˜ä½¿ç”¨ç‡
- å®¹å™¨ CPU/å†…å­˜ä½¿ç”¨
- API è¯·æ±‚å“åº”æ—¶é—´
- ç¼“å­˜å‘½ä¸­ç‡

#### 3. å¤‡ä»½ç­–ç•¥

**éœ€è¦å¤‡ä»½**ï¼š
- æ¨¡å‹æ–‡ä»¶ï¼ˆ`models/` ç›®å½•ï¼‰
- ç¼“å­˜æ–‡ä»¶ï¼ˆ`cache/` ç›®å½•ï¼Œå¯é€‰ï¼‰
- é…ç½®æ–‡ä»¶

**å¤‡ä»½å‘½ä»¤**ï¼š
```bash
# å¤‡ä»½æ¨¡å‹
tar -czf models-backup.tar.gz models/

# å¤‡ä»½ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
tar -czf cache-backup.tar.gz cache/
```

---

## ğŸ“š æ–‡æ¡£èµ„æº

### æ ¸å¿ƒæ–‡æ¡£

- **[API ä½¿ç”¨æŒ‡å—](docs/api-guide.md)** - å®Œæ•´çš„ API æ¥å£æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
  - æ‰€æœ‰ç«¯ç‚¹è¯´æ˜
  - è¯·æ±‚/å“åº”æ ¼å¼
  - æ¨¡å‹å˜ä½“é€‰æ‹©æŒ‡å—
  - å®æˆ˜ç¤ºä¾‹ä»£ç 
- **[æ€§èƒ½ä¼˜åŒ–æŒ‡å—](docs/funasr-optimization-guide.md)** - è¯¦ç»†çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ
  - FunASR ç¼–ç å™¨ä¼˜åŒ–ï¼ˆ83% æ—¶é—´ç“¶é¢ˆï¼‰
  - 6 ç§ä¼˜åŒ–æ–¹æ¡ˆå¯¹æ¯”
  - ä¸‰é˜¶æ®µå®æ–½è·¯çº¿å›¾
  - é¢„æœŸæ€§èƒ½æå‡æ•°æ®
- **[ä¼˜åŒ–æ€»ç»“](docs/OPTIMIZATION_SUMMARY.md)** - æ€§èƒ½ä¼˜åŒ–å·¥ä½œæ€»ç»“
  - å·²å®Œæˆä¼˜åŒ–æ¸…å•
  - æŠ•èµ„å›æŠ¥ç‡åˆ†æ
  - ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### æŠ€æœ¯æ–‡æ¡£

- **[FunASR ç¼“å­˜ä¼˜åŒ–](docs/funasr-cache-optimization.md)** - ç¼“å­˜æœºåˆ¶è¯¦è§£
  - ç¼“å­˜å®ç°åŸç†
  - é€‚ç”¨åœºæ™¯åˆ†æ
  - æ€§èƒ½æå‡æ•°æ®
- **[æ¨¡å‹æ€§èƒ½åˆ†æ](docs/model-performance-analysis.md)** - æ¨¡å‹æ€§èƒ½æ·±åº¦åˆ†æ
- **[UI æ€§èƒ½æµ‹è¯•ç»“æœ](docs/ui-performance-test-result.md)** - UI å®é™…æµ‹è¯•æ•°æ®
  - Base/BnB/AWQ ä¸‰ç§æ¨¡å‹å¯¹æ¯”
  - ä¸ºä»€ä¹ˆ BnB å’Œ Base é€Ÿåº¦ç›¸åŒ
  - æ¨¡å‹é€‰æ‹©å»ºè®®
- **[ä¸‰æ¨¡å‹åŸºå‡†æµ‹è¯•](docs/three-models-benchmark.md)** - å®Œæ•´åŸºå‡†æµ‹è¯•æŠ¥å‘Š

### éƒ¨ç½²æ–‡æ¡£

- **[API éƒ¨ç½²æˆåŠŸæŠ¥å‘Š](API_DEPLOYMENT_SUCCESS.md)** - API å®¹å™¨éƒ¨ç½²è¯¦ç»†è¯´æ˜
- **[Docker éƒ¨ç½²å®¡è®¡](DOCKER_DEPLOYMENT_AUDIT.md)** - Docker éƒ¨ç½²å®Œæ•´å®¡è®¡
- **[ç¼“å­˜ä¿®å¤æŠ¥å‘Š](CACHE_AND_LOG_FIX.md)** - ç¼“å­˜åŠŸèƒ½ä¿®å¤è¯´æ˜
- **[API cURL ç¤ºä¾‹](docs/api-curl-demos.md)** - å®Œæ•´çš„ cURL ä½¿ç”¨ç¤ºä¾‹

---

## ğŸ“‘ å¼€æºè®¡åˆ’

- [x] æ¨ç†ä»£ç 
- [x] åœ¨çº¿æ¼”ç¤º (Gradio)
- [x] æ¨¡å‹æ£€æŸ¥ç‚¹
  - [x] Step-Audio-Tokenizer
  - [x] Step-Audio-EditX
  - [ ] Step-Audio-EditX-Int4
- [ ] Step-Audio-Edit-Benchmark
- [ ] è®­ç»ƒä»£ç 
  - [ ] SFT è®­ç»ƒ
  - [ ] PPO è®­ç»ƒ
- [ ] â³ åŠŸèƒ½æ”¯æŒè®¡åˆ’
  - [ ] ç¼–è¾‘
    - [x] å¤šéŸ³å­—å‘éŸ³æ§åˆ¶
    - [ ] æ›´å¤šå‰¯è¯­è¨€æ ‡ç­¾ï¼ˆCough, Crying, Stress ç­‰ï¼‰
    - [ ] å¡«å……è¯ç§»é™¤
  - [ ] å…¶ä»–è¯­è¨€
    - [ ] æ—¥è¯­ã€éŸ©è¯­ã€é˜¿æ‹‰ä¼¯è¯­ã€æ³•è¯­ã€ä¿„è¯­ã€è¥¿ç­ç‰™è¯­ç­‰

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### Python å®¢æˆ·ç«¯ç¤ºä¾‹

```python
import requests

API_BASE = "http://localhost:8003"

# 1. å¥åº·æ£€æŸ¥
response = requests.get(f"{API_BASE}/healthz")
print(response.json())  # {"status": "ok"}

# 2. ç”ŸæˆéŸ³é¢‘ï¼ˆClone æ¨¡å¼ï¼‰
data = {
    "model": "step-audio-editx",
    "voice": "happy_en",
    "input": "Hello! This is a test.",
    "response_format": "wav",
    "step_audio": {
        "mode": "clone",
        "model_variant": "base",
        "intensity": 1.0
    }
}
response = requests.post(
    f"{API_BASE}/v1/audio/speech",
    json=data,
    stream=True
)
with open("output.wav", "wb") as f:
    for chunk in response.iter_content(chunk_size=8192):
        f.write(chunk)
print("éŸ³é¢‘å·²ä¿å­˜åˆ° output.wav")
```

### cURL ç¤ºä¾‹

```bash
# Clone æ¨¡å¼
curl -X POST http://localhost:8003/v1/audio/speech \
  -H "Content-Type: application/json" \
  -d '{
    "model": "step-audio-editx",
    "voice": "happy_en",
    "input": "Hello! This is a test.",
    "step_audio": {
      "mode": "clone",
      "model_variant": "base",
      "intensity": 1.0
    }
  }' \
  --output clone.wav

# Emotion ç¼–è¾‘
curl -X POST http://localhost:8003/v1/audio/speech \
  -H "Content-Type: application/json" \
  -d '{
    "model": "step-audio-editx",
    "voice": "fear_female",
    "input": "æˆ‘çœŸçš„å¾ˆå®³æ€•",
    "step_audio": {
      "mode": "emotion",
      "edit_info": "fear",
      "model_variant": "base",
      "intensity": 2.0
    }
  }' \
  --output emotion_fear.wav
```

---

## ğŸ“Š æ€§èƒ½åŸºå‡†

### å®é™…æµ‹è¯•æ•°æ®

åŸºäº L40S GPU (48GB) çš„å®æµ‹æ•°æ®ï¼š

| åœºæ™¯ | è€—æ—¶ | è¯´æ˜ | æ€§èƒ½æå‡ |
|------|------|------|---------|
| **åŸå§‹åŸºçº¿ï¼ˆæœªä¼˜åŒ–ï¼‰** | 24s | æœªå¯ç”¨ä»»ä½•ä¼˜åŒ– | - |
| **TF32 + ONNX ä¼˜åŒ–å** | 17s | é¦–è½®ä¼˜åŒ– | +29% |
| **é¦–æ¬¡è¿è¡Œï¼ˆæ— ç¼“å­˜ï¼‰** | 12s | åŒ…å« FunASR ç¼–ç  | +50% |
| **ç¼“å­˜å‘½ä¸­** | **8s** | **æœ€ä¼˜æ€§èƒ½** âœ… | **+66%** |

### æ€§èƒ½ç“¶é¢ˆåˆ†æ

å®Œæ•´ Clone æµç¨‹çš„æ—¶é—´åˆ†è§£ï¼š

```
åŸå§‹åŸºçº¿ï¼ˆ24s æ€»è®¡ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ”´ éŸ³é¢‘ç¼–ç  (FunASR):     ~20s  (83%)  â† ä¸»è¦ç“¶é¢ˆ
  ğŸŸ¢ LLM ç”Ÿæˆ:               ~2s  (8%)
  ğŸŸ¢ éŸ³é¢‘è§£ç  (CosyVoice):   ~2s  (8%)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¼˜åŒ–åï¼ˆç¼“å­˜å‘½ä¸­ï¼Œ8s æ€»è®¡ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âœ… ç¼“å­˜æŸ¥è¯¢:              ~0.006s (0.1%)  â† å‡ ä¹ç¬é—´ï¼
  ğŸŸ¢ LLM ç”Ÿæˆ:               ~2s  (25%)
  ğŸŸ¢ éŸ³é¢‘è§£ç :               ~2s  (25%)
  ğŸŸ¢ å…¶ä»–å¤„ç†:               ~4s  (50%)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**å…³é”®æ´å¯Ÿ**ï¼šFunASR ç¼–ç å  83% æ—¶é—´ï¼Œä¼˜åŒ–å®ƒæ¯”ä¼˜åŒ– LLM æ›´æœ‰ä»·å€¼ï¼ˆæŠ•èµ„å›æŠ¥ç‡é«˜ 10 å€ï¼‰ï¼

### ç¼“å­˜æ•ˆæœ

- **ç¼“å­˜å‘½ä¸­ç‡**ï¼š70%+ï¼ˆä½¿ç”¨ç›¸åŒéŸ³é¢‘æ—¶ï¼‰
- **æ¯æ¬¡å‘½ä¸­èŠ‚çœ**ï¼š~4sï¼ˆçº¦ 33% æ—¶é—´ï¼‰
- **FunASR ç¼–ç åŠ é€Ÿ**ï¼šä» 4.8s â†’ 0.006sï¼ˆ**æé€Ÿ 800x**ï¼‰
- **æŒä¹…åŒ–**ï¼šå®¹å™¨é‡å¯åç¼“å­˜ä¿ç•™
- **å¤šéŸ³é¢‘æ”¯æŒ**ï¼šåˆ‡æ¢éŸ³é¢‘åå†åˆ‡å›ï¼Œä»ç„¶å‘½ä¸­ç¼“å­˜

### æ¨¡å‹å˜ä½“æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹å˜ä½“ | å®é™…è€—æ—¶ | ç›¸å¯¹æ€§èƒ½ | ç£ç›˜å ç”¨ | æ¨èåœºæ™¯ |
|---------|---------|---------|----------|---------|
| `base` | 24s | 1.00x | 16 GB | è¿½æ±‚æœ€é«˜éŸ³è´¨ |
| `bnb` | 24s | 1.00x âš¡ | 7.1 GB | **å¼ºçƒˆæ¨è**ï¼ˆé»˜è®¤ï¼‰|
| `awq` | 34s | 0.71x | 7.1 GB | ä¸æ¨èï¼ˆæ…¢ 42%ï¼‰|

**è¯¦ç»†åˆ†æ**ï¼šè¯·å‚è€ƒ [UI æ€§èƒ½æµ‹è¯•ç»“æœ](docs/ui-performance-test-result.md)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

- **æäº¤ Issue**: [GitHub Issues](https://github.com/stepfun-ai/Step-Audio-EditX/issues)
- **åŠŸèƒ½è®¨è®º**: [GitHub Discussions](https://github.com/stepfun-ai/Step-Audio-EditX/discussions)

---

## ğŸ“„ License

æœ¬é¡¹ç›®ä»£ç é‡‡ç”¨ [Apache 2.0](LICENSE) è®¸å¯è¯å¼€æºã€‚

---

## âš ï¸ ä½¿ç”¨å£°æ˜

- è¯·å‹¿å°†æ­¤æ¨¡å‹ç”¨äºä»»ä½•æœªç»æˆæƒçš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š
  - æœªç»è®¸å¯çš„è¯­éŸ³å…‹éš†
  - èº«ä»½å†’å……
  - æ¬ºè¯ˆ
  - æ·±åº¦ä¼ªé€ æˆ–å…¶ä»–éæ³•ç”¨é€”
- ä½¿ç”¨æœ¬æ¨¡å‹æ—¶ï¼Œè¯·ç¡®ä¿éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„ï¼Œå¹¶éµå¾ªé“å¾·å‡†åˆ™
- æ¨¡å‹å¼€å‘è€…ä¸å¯¹ä»»ä½•æ»¥ç”¨æˆ–è¯¯ç”¨æ­¤æŠ€æœ¯çš„è¡Œä¸ºè´Ÿè´£

---

## ğŸ“ è·å–å¸®åŠ©

- **GitHub Issues**: [æäº¤é—®é¢˜](https://github.com/stepfun-ai/Step-Audio-EditX/issues)
- **Discussions**: [åŠŸèƒ½è®¨è®º](https://github.com/stepfun-ai/Step-Audio-EditX/discussions)

---

## ğŸ‰ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸º Step-Audio-EditX é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç”¨æˆ·ï¼

---

**ğŸ‰ ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ•…éšœæ’æŸ¥éƒ¨åˆ†æˆ–æäº¤ Issueã€‚**
